{"code":"import { __awaiter, __generator } from \"tslib\";\r\nimport { MP4Demuxer } from './type';\r\nimport { WebVideoDecoder } from './decoder';\r\nimport { beginEncode } from './encode';\r\n// import  'dom-webcodecs';\r\nvar mediaStream;\r\n//video decode（也许这也应该开两个worker）\r\nexport function decode(location) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var demuxer, trackGenerator, framewWriter, framecount, deocodeInit, decoder;\r\n        return __generator(this, function (_a) {\r\n            demuxer = new MP4Demuxer(location);\r\n            trackGenerator = new MediaStreamTrackGenerator({ kind: 'video' });\r\n            framewWriter = trackGenerator.writable.getWriter();\r\n            mediaStream = new MediaStream([trackGenerator]);\r\n            framecount = 0;\r\n            deocodeInit = {\r\n                output: function (frame) {\r\n                    framewWriter.write(frame);\r\n                    framecount++;\r\n                    console.log(framecount);\r\n                },\r\n                error: function (e) { return console.error(e); }\r\n            };\r\n            decoder = WebVideoDecoder.getInstance(deocodeInit);\r\n            demuxer.getConfig().then(function (config) {\r\n                decoder.configure(config);\r\n                demuxer.start(function (chunk) { decoder.decode(chunk); });\r\n            });\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n}\r\nexport function encode() {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        return __generator(this, function (_a) {\r\n            beginEncode(mediaStream);\r\n            return [2 /*return*/];\r\n        });\r\n    });\r\n}\r\nexport function transcode(location) {\r\n    decode(location);\r\n}\r\n","references":["/home/wudi/desktop/code/ts/vue3/vite-ts-test/web/packages/poco-codec/src/codec/type.ts","/home/wudi/desktop/code/ts/vue3/vite-ts-test/web/packages/poco-codec/src/codec/decoder.ts","/home/wudi/desktop/code/ts/vue3/vite-ts-test/web/packages/poco-codec/src/codec/encode.ts"]}
